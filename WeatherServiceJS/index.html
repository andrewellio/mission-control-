<!-- Fetches weather data from OpenWeather API using geographical co-ordinates-->
<!-- ENGR 301/302 Victoria University of Wellington 2020-->
<!-- Rocket Launch: Mission Control: Group 12-->
<!-- Elliott Andrews & Marcus Rathod-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!-- <title>Mission Control Software: Weather</title>  Unless predefined somewhere else-->
</head>
<body>
    <h2>Weather Information</h2>

    Latitude:  <input type="text" placeholder="e.g. -41.2769" id="latID">
    Longitude:  <input type="text" placeholder="e.g. 174.7731" id="lonID">
    <button type="button" onclick="getJson();">Get Weather</button>
    <!-- Will need proper value checks, e.g. button and text field should stay if not valid city name-->

    <p id="weatherdata"> Please enter required fields above </p>

<script type="text/javascript">

function getJson(){

    var lat = document.getElementById("latID").value;
    var lon = document.getElementById("lonID").value;

    var URL = "https://api.openweathermap.org/data/2.5/weather?lat="+lat+"&lon="+lon+"&APPID=9dbce15b12f75333f8f274f51793d0ff&mode=json&units=metric" //mode=html should be used for dashboard
    
    var Httpreq = new XMLHttpRequest(); 

    Httpreq.open("GET",URL,false);
    Httpreq.send(null);

    var json = JSON.parse(Httpreq.responseText);
    

    document.getElementById("weatherdata").innerHTML = "Current weather for: *" + json.name + 
    "<br>Humidity: "+ json.main.humidity + "%" +
    "<br>Wind Speed: "+ json.wind.speed + " m/s" +
    "<br>Wind Direction: "+ (json.wind.deg*(Math.PI/180)) + " radians" +
    "<br>Temperature: "+ json.main.temp + "Â°C" + //Beware of this symbol, may cause problems when packaging
    "<br>Air Pressure: "+ json.main.pressure + " hPa" +
    "<br><br><br>*Approximate Location"; 
}


//References
//https://stackoverflow.com/questions/2499567/how-to-make-a-json-call-to-a-url/2499647#2499647
//https://www.tutorialrepublic.com/faq/how-to-get-the-value-of-text-input-field-using-javascript.php
//https://www.tutorialrepublic.com/javascript-tutorial/javascript-json-parsing.php

</script>
</body>
</html>

